<h1>Hello World</h1>
<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 8</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('sky', 'assets/sky.png');
    game.load.image('ground', 'assets/platform.png');
    game.load.image('star', 'assets/person.png');
    game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
    game.load.image('library', 'assets/person.png');
    game.load.image('pixel', 'assets/pixel.png');

    
}

var player;
var platforms;
var cursors;

var stars;
var library;
var libraryPixel;

function create() {

    //  We're going to be using physics, so enable the Arcade Physics system
    game.physics.startSystem(Phaser.Physics.ARCADE);

    //  A simple background for our game
    game.add.sprite(0, 0, 'sky');

    //  The platforms group contains the ground and the 2 ledges we can jump on
    platforms = game.add.group();

    //  We will enable physics for any object that is created in this group
    platforms.enableBody = true;

    // Here we create the ground.
    var ground = platforms.create(0, game.world.height - 2, 'ground');

    //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
    ground.scale.setTo(2, 2);

    //  This stops it from falling away when you jump on it
    ground.body.immovable = true;

    //  Now let's create two ledges
    var ledge = platforms.create(0, 300, 'ground');
    ledge.scale.setTo(2, 1);
    ledge.body.immovable = true;

    // The player and its settings
    player = game.add.sprite(770, 280, 'dude');

    game.physics.arcade.enable(player);

    stars = game.add.group();

    stars.enableBody = true;

    for (var i = 0; i < 400; i++)
    {
        //  Create a star inside of the 'stars' group
        var star = stars.create(i * (750/400) + getRandomInt(1,9), 295+getRandomInt(-15,15), 'star');
        star.scale.setTo(.33,.33)
        star.body.velocity.x = 100+getRandomInt(1,10);
        star.state = "right";
        star.mode = "none";
    }

    library = game.add.group();
    library.enableBody = true;
    library.create(100, 295, 'library');
    libraryPixel = game.add.group();
    libraryPixel.enableBody = true;
    libraryPixel.create(100, 295, 'pixel');
    
}

function update() {
    game.physics.arcade.collide(player, platforms);
    game.physics.arcade.overlap(player, stars, checkKillStar, null, this);

    for(var i=0; i<stars.children.length; i++){
		checkLibrary(stars.children[i]);
		checkCoffee(stars.children[i]);
		checkHotel(stars.children[i]);
		checkAirport(stars.children[i]);
	}

}

function checkLibrary(star){
	if(star.x == 100+getRandomInt(-5,5) && star.state == "right"){
		if(getRandomInt(0,1000) > 900){
		    star.body.velocity.x = 0;
		    star.body.velocity.y = 50;
			star.state = "downLib";
		}
	}
	if(star.y >= 500 && star.state == "downLib"){
		star.body.velocity.y = 0;
		star.state = "stopLib";
		star.tickCount = 0;
	}
	if(star.state=="stopLib"){
		if(star.tickCount > 200){
			star.body.velocity.y = -50;
			star.state = "upLib";
		}
		star.tickCount++;
	}
	if(star.y <= 300 && star.state=="upLib"){
		star.state="right";
		star.body.velocity.x = 100+getRandomInt(1,10);
		star.body.velocity.y = 0;
		star.y = 295+getRandomInt(-15,15);
	}
}

function checkCoffee(star){
	if(star.x == 200+getRandomInt(-5,5) && star.state == "right"){
		if(getRandomInt(0,1000) > 500){
		    star.body.velocity.x = 0;
		    star.body.velocity.y = -100;
			star.state = "upCoff";
		}
	}
	if(star.y <= 200 && star.state == "upCoff"){
		star.body.velocity.y = 0;
		star.state = "stopCoff";
		star.tickCount = 0;
	}
	if(star.state=="stopCoff"){
		if(star.tickCount > 100){
			star.body.velocity.y = 200;
			star.state = "downCoff";
		}
		star.tickCount++;
	}
	if(star.y >= 300 && star.state=="downCoff"){
		star.state="right";
		star.body.velocity.x = 100+getRandomInt(1,10);
		star.body.velocity.y = 0;
		star.y = 295+getRandomInt(-15,15);
	}
}

function checkHotel(star){
	if(star.x == 500+getRandomInt(-5,5) && star.state == "right"){
		if(getRandomInt(0,1000) > 800){
		    star.body.velocity.x = 0;
		    star.body.velocity.y = 45;
			star.state = "downHot";
		}
	}
	if(star.y >= 400 && star.state == "downHot"){
		star.body.velocity.y = 0;
		star.state = "stopHot";
		star.tickCount = 0;
	}
	if(star.state=="stopHot"){
		if(star.tickCount > 500){
			star.body.velocity.y = -45;
			star.state = "upHot";
		}
		star.tickCount++;
	}
	if(star.y <= 300 && star.state=="upHot"){
		star.state="right";
		star.body.velocity.x = 100+getRandomInt(1,10);
		star.body.velocity.y = 0;
		star.y = 295+getRandomInt(-15,15);
	}
}

function checkAirport(star){
	if(star.x == 600+getRandomInt(-5,5) && star.state == "right"){
		if(getRandomInt(0,1000) > 750){
		    star.body.velocity.x = 0;
		    star.body.velocity.y = -300;
			star.state = "upAir";
		}
	}
	if(star.y <= 120 && star.state == "upAir"){
		star.body.velocity.y = 0;
		star.state = "stopAir";
		star.tickCount = 0;
	}
	if(star.state=="stopAir"){
		if(star.tickCount > 220){
			star.body.velocity.y = 140;
			star.state = "downAir";
		}
		star.tickCount++;
	}
	if(star.y >= 300 && star.state=="downAir"){
		star.state="right";
		star.body.velocity.x = 100+getRandomInt(1,10);
		star.body.velocity.y = 0;
		star.y = 295+getRandomInt(-15,15);
	}
}

function checkKillStar (star) {
	if(star.x > 770){
		star.x = 20+getRandomInt(1,9);
		star.body.velocity.x = 100;
	}
}

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>

</body>
</html>